# Assistant Journalist Bot - Windows Auto Installer
# Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø± Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ²
# Ù†Ø³Ø®Ù‡: 1.0.0
# ØªØ§Ø±ÛŒØ®: 2025

param(
    [string]$InstallPath = "$env:USERPROFILE\AssistantJournalistBot",
    [string]$GitRepo = "https://github.com/your-username/assistant-journalist-bot.git",
    [switch]$SkipChocolatey,
    [switch]$SkipPython,
    [switch]$SkipGit,
    [switch]$SkipFFmpeg,
    [switch]$Silent,
    [switch]$Help
)

# Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
$Colors = @{
    Red = "Red"
    Green = "Green"
    Yellow = "Yellow"
    Blue = "Blue"
    Cyan = "Cyan"
    Magenta = "Magenta"
    White = "White"
}

# Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
$Script:ErrorCount = 0
$Script:WarningCount = 0
$Script:LogFile = "$env:TEMP\assistant-bot-install.log"
$Script:StartTime = Get-Date

# ====================================================================
# ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
# ====================================================================

function Write-ColoredOutput {
    param(
        [string]$Message,
        [string]$Color = "White",
        [string]$Level = "INFO"
    )
    
    $timestamp = Get-Date -Format "HH:mm:ss"
    $logMessage = "[$timestamp] [$Level] $Message"
    
    # Ù†ÙˆØ´ØªÙ† Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
    if (-not $Silent) {
        Write-Host "[$timestamp] " -NoNewline -ForegroundColor Gray
        Write-Host $Message -ForegroundColor $Color
    }
    
    # Ù†ÙˆØ´ØªÙ† Ø¯Ø± Ù„Ø§Ú¯
    Add-Content -Path $Script:LogFile -Value $logMessage
}

function Write-Success {
    param([string]$Message)
    Write-ColoredOutput "âœ… $Message" -Color $Colors.Green -Level "SUCCESS"
}

function Write-Error {
    param([string]$Message)
    Write-ColoredOutput "âŒ $Message" -Color $Colors.Red -Level "ERROR"
    $Script:ErrorCount++
}

function Write-Warning {
    param([string]$Message)
    Write-ColoredOutput "âš ï¸  $Message" -Color $Colors.Yellow -Level "WARNING"
    $Script:WarningCount++
}

function Write-Info {
    param([string]$Message)
    Write-ColoredOutput "â„¹ï¸  $Message" -Color $Colors.Cyan -Level "INFO"
}

function Write-Step {
    param([string]$Message)
    Write-ColoredOutput "ğŸ”„ $Message" -Color $Colors.Blue -Level "STEP"
}

function Show-Banner {
    if ($Silent) { return }
    
    $banner = @"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘    ğŸ¤– Assistant Journalist Bot - Windows Installer          â•‘
â•‘                                                              â•‘
â•‘         Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø± Ø¯Ø± ÙˆÛŒÙ†Ø¯ÙˆØ²            â•‘
â•‘                                                              â•‘
â•‘    ğŸ“‹ Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ù†ØµØ¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:                  â•‘
â•‘       â€¢ Python 3.11                                         â•‘
â•‘       â€¢ Git                                                  â•‘
â•‘       â€¢ FFmpeg                                               â•‘
â•‘       â€¢ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²                                â•‘
â•‘       â€¢ Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±                                  â•‘
â•‘                                                              â•‘
â•‘    âš ï¸  Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø±Ø¯               â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@
    
    Write-Host $banner -ForegroundColor Cyan
    Write-Host ""
}

function Show-Help {
    $helpText = @"
Assistant Journalist Bot - Windows Auto Installer

Ø§Ø³ØªÙØ§Ø¯Ù‡:
    .\install.ps1 [Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§]

Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:
    -InstallPath <path>     Ù…Ø³ÛŒØ± Ù†ØµØ¨ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: %USERPROFILE%\AssistantJournalistBot)
    -GitRepo <url>          Ø¢Ø¯Ø±Ø³ Ù…Ø®Ø²Ù† Git
    -SkipChocolatey        Ø¹Ø¯Ù… Ù†ØµØ¨ Chocolatey
    -SkipPython            Ø¹Ø¯Ù… Ù†ØµØ¨ Python
    -SkipGit               Ø¹Ø¯Ù… Ù†ØµØ¨ Git
    -SkipFFmpeg            Ø¹Ø¯Ù… Ù†ØµØ¨ FFmpeg
    -Silent                Ø­Ø§Ù„Øª Ø³Ø§Ú©Øª (Ø¨Ø¯ÙˆÙ† Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§)
    -Help                  Ù†Ù…Ø§ÛŒØ´ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§

Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§:
    .\install.ps1
    .\install.ps1 -InstallPath "C:\MyBots\JournalistBot"
    .\install.ps1 -SkipChocolatey -Silent
    .\install.ps1 -Help

Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾ØªØŒ PowerShell Ø±Ø§ Ø¨Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.
"@
    
    Write-Host $helpText -ForegroundColor White
    exit 0
}

function Test-AdminRights {
    $currentUser = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = New-Object Security.Principal.WindowsPrincipal($currentUser)
    return $principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
}

function Test-InternetConnection {
    try {
        $null = Test-NetConnection -ComputerName "google.com" -Port 80 -InformationLevel Quiet -WarningAction SilentlyContinue
        return $true
    }
    catch {
        return $false
    }
}

function Install-Chocolatey {
    if ($SkipChocolatey) {
        Write-Info "Ù†ØµØ¨ Chocolatey Ø±Ø¯ Ø´Ø¯"
        return $true
    }
    
    Write-Step "Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ Chocolatey..."
    
    if (Get-Command choco -ErrorAction SilentlyContinue) {
        Write-Success "Chocolatey Ù‚Ø¨Ù„Ø§Ù‹ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø§Ø³Øª"
        return $true
    }
    
    Write-Step "Ù†ØµØ¨ Chocolatey..."
    
    try {
        # ØªÙ†Ø¸ÛŒÙ… Ø³ÛŒØ§Ø³Øª Ø§Ø¬Ø±Ø§
        Set-ExecutionPolicy Bypass -Scope Process -Force
        
        # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ Chocolatey
        [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
        $installScript = (New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')
        Invoke-Expression $installScript
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨
        if (Get-Command choco -ErrorAction SilentlyContinue) {
            Write-Success "Chocolatey Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
            
            # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ PATH
            $env:Path = [System.Environment]::GetEnvironmentVariable("Path", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path", "User")
            
            return $true
        }
        else {
            Write-Error "Ù†ØµØ¨ Chocolatey Ø¨Ø§ Ø´Ú©Ø³Øª Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Chocolatey: $($_.Exception.Message)"
        return $false
    }
}

function Install-Python {
    if ($SkipPython) {
        Write-Info "Ù†ØµØ¨ Python Ø±Ø¯ Ø´Ø¯"
        return $true
    }
    
    Write-Step "Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ Python..."
    
    # Ø¨Ø±Ø±Ø³ÛŒ Python Ù…ÙˆØ¬ÙˆØ¯
    try {
        $pythonVersion = python --version 2>&1
        if ($pythonVersion -match "Python 3\.([9-9]|1[0-9])") {
            Write-Success "Python $pythonVersion Ù‚Ø¨Ù„Ø§Ù‹ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø§Ø³Øª"
            return $true
        }
        elseif ($pythonVersion -match "Python") {
            Write-Warning "Ù†Ø³Ø®Ù‡ Python Ø´Ù…Ø§ ($pythonVersion) Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³Øª. Ù†Ø³Ø®Ù‡ 3.9+ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø§Ø³Øª"
        }
    }
    catch {
        Write-Info "Python Ù†ØµØ¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"
    }
    
    Write-Step "Ù†ØµØ¨ Python 3.11..."
    
    try {
        if (Get-Command choco -ErrorAction SilentlyContinue) {
            # Ù†ØµØ¨ Ø¨Ø§ Chocolatey
            $chocoResult = choco install python --version=3.11.7 -y
            if ($LASTEXITCODE -eq 0) {
                Write-Success "Python 3.11 Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
            }
            else {
                Write-Warning "Ù†ØµØ¨ Python Ø¨Ø§ Chocolatey Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ØŒ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø¯Ø³ØªÛŒ..."
                return Install-PythonManual
            }
        }
        else {
            return Install-PythonManual
        }
        
        # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ PATH
        $env:Path = [System.Environment]::GetEnvironmentVariable("Path", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path", "User")
        
        # ØªØ³Øª Ù†ØµØ¨
        Start-Sleep 3
        $pythonVersion = python --version 2>&1
        if ($pythonVersion -match "Python 3\.1[0-9]") {
            Write-Success "Python Ù†ØµØ¨ Ùˆ ØªØ³Øª Ø´Ø¯: $pythonVersion"
            return $true
        }
        else {
            Write-Error "ØªØ³Øª Python Ù†Ø§Ù…ÙˆÙÙ‚: $pythonVersion"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Python: $($_.Exception.Message)"
        return $false
    }
}

function Install-PythonManual {
    Write-Step "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ Ø¯Ø³ØªÛŒ Python..."
    
    try {
        $pythonUrl = "https://www.python.org/ftp/python/3.11.7/python-3.11.7-amd64.exe"
        $pythonInstaller = "$env:TEMP\python-3.11.7-amd64.exe"
        
        Write-Info "Ø¯Ø§Ù†Ù„ÙˆØ¯ Python Ø§Ø² $pythonUrl"
        Invoke-WebRequest -Uri $pythonUrl -OutFile $pythonInstaller -UseBasicParsing
        
        Write-Info "Ù†ØµØ¨ Python..."
        $installArgs = @(
            "/quiet",
            "InstallAllUsers=1",
            "PrependPath=1",
            "Include_test=0",
            "Include_doc=0",
            "Include_dev=0",
            "Include_debug=0",
            "Include_launcher=1",
            "InstallLauncherAllUsers=1"
        )
        
        Start-Process -FilePath $pythonInstaller -ArgumentList $installArgs -Wait
        
        # Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ù†ØµØ¨
        Remove-Item $pythonInstaller -Force
        
        Write-Success "Python Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
        return $true
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Ø¯Ø³ØªÛŒ Python: $($_.Exception.Message)"
        return $false
    }
}

function Install-Git {
    if ($SkipGit) {
        Write-Info "Ù†ØµØ¨ Git Ø±Ø¯ Ø´Ø¯"
        return $true
    }
    
    Write-Step "Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ Git..."
    
    if (Get-Command git -ErrorAction SilentlyContinue) {
        $gitVersion = git --version
        Write-Success "Git Ù‚Ø¨Ù„Ø§Ù‹ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø§Ø³Øª: $gitVersion"
        return $true
    }
    
    Write-Step "Ù†ØµØ¨ Git..."
    
    try {
        if (Get-Command choco -ErrorAction SilentlyContinue) {
            choco install git -y
            if ($LASTEXITCODE -eq 0) {
                Write-Success "Git Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
            }
            else {
                Write-Error "Ù†ØµØ¨ Git Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯"
                return $false
            }
        }
        else {
            Write-Warning "Chocolatey Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Git Ø±Ø§ Ø§Ø² https://git-scm.com Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯"
            return $false
        }
        
        # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ PATH
        $env:Path = [System.Environment]::GetEnvironmentVariable("Path", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path", "User")
        
        # ØªØ³Øª Ù†ØµØ¨
        Start-Sleep 2
        if (Get-Command git -ErrorAction SilentlyContinue) {
            $gitVersion = git --version
            Write-Success "Git Ù†ØµØ¨ Ùˆ ØªØ³Øª Ø´Ø¯: $gitVersion"
            return $true
        }
        else {
            Write-Error "ØªØ³Øª Git Ù†Ø§Ù…ÙˆÙÙ‚"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Git: $($_.Exception.Message)"
        return $false
    }
}

function Install-FFmpeg {
    if ($SkipFFmpeg) {
        Write-Info "Ù†ØµØ¨ FFmpeg Ø±Ø¯ Ø´Ø¯"
        return $true
    }
    
    Write-Step "Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨ FFmpeg..."
    
    if (Get-Command ffmpeg -ErrorAction SilentlyContinue) {
        $ffmpegVersion = ffmpeg -version 2>&1 | Select-String "ffmpeg version" | Select-Object -First 1
        Write-Success "FFmpeg Ù‚Ø¨Ù„Ø§Ù‹ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø§Ø³Øª: $ffmpegVersion"
        return $true
    }
    
    Write-Step "Ù†ØµØ¨ FFmpeg..."
    
    try {
        if (Get-Command choco -ErrorAction SilentlyContinue) {
            choco install ffmpeg -y
            if ($LASTEXITCODE -eq 0) {
                Write-Success "FFmpeg Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
            }
            else {
                Write-Error "Ù†ØµØ¨ FFmpeg Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯"
                return $false
            }
        }
        else {
            Write-Warning "Chocolatey Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. FFmpeg Ø¨Ø§ÛŒØ¯ Ø¯Ø³ØªÛŒ Ù†ØµØ¨ Ø´ÙˆØ¯"
            return Install-FFmpegManual
        }
        
        # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ PATH
        $env:Path = [System.Environment]::GetEnvironmentVariable("Path", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path", "User")
        
        # ØªØ³Øª Ù†ØµØ¨
        Start-Sleep 2
        if (Get-Command ffmpeg -ErrorAction SilentlyContinue) {
            Write-Success "FFmpeg Ù†ØµØ¨ Ùˆ ØªØ³Øª Ø´Ø¯"
            return $true
        }
        else {
            Write-Error "ØªØ³Øª FFmpeg Ù†Ø§Ù…ÙˆÙÙ‚"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ FFmpeg: $($_.Exception.Message)"
        return $false
    }
}

function Install-FFmpegManual {
    Write-Step "Ù†ØµØ¨ Ø¯Ø³ØªÛŒ FFmpeg..."
    
    try {
        $ffmpegUrl = "https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip"
        $ffmpegZip = "$env:TEMP\ffmpeg.zip"
        $ffmpegExtractPath = "$env:TEMP\ffmpeg"
        $ffmpegInstallPath = "$env:ProgramFiles\FFmpeg"
        
        Write-Info "Ø¯Ø§Ù†Ù„ÙˆØ¯ FFmpeg..."
        Invoke-WebRequest -Uri $ffmpegUrl -OutFile $ffmpegZip -UseBasicParsing
        
        Write-Info "Ø§Ø³ØªØ®Ø±Ø§Ø¬ FFmpeg..."
        Expand-Archive -Path $ffmpegZip -DestinationPath $ffmpegExtractPath -Force
        
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù¾ÙˆØ´Ù‡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡
        $extractedFolder = Get-ChildItem -Path $ffmpegExtractPath -Directory | Select-Object -First 1
        
        # Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        if (Test-Path $ffmpegInstallPath) {
            Remove-Item $ffmpegInstallPath -Recurse -Force
        }
        New-Item -ItemType Directory -Path $ffmpegInstallPath -Force
        Copy-Item -Path "$($extractedFolder.FullName)\*" -Destination $ffmpegInstallPath -Recurse -Force
        
        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ PATH
        $currentPath = [System.Environment]::GetEnvironmentVariable("Path", "Machine")
        $ffmpegBinPath = "$ffmpegInstallPath\bin"
        
        if ($currentPath -notlike "*$ffmpegBinPath*") {
            $newPath = "$currentPath;$ffmpegBinPath"
            [System.Environment]::SetEnvironmentVariable("Path", $newPath, "Machine")
            $env:Path = "$env:Path;$ffmpegBinPath"
        }
        
        # Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙ‚Øª
        Remove-Item $ffmpegZip -Force
        Remove-Item $ffmpegExtractPath -Recurse -Force
        
        Write-Success "FFmpeg Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯"
        return $true
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Ø¯Ø³ØªÛŒ FFmpeg: $($_.Exception.Message)"
        return $false
    }
}

function Download-BotSource {
    Write-Step "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ù…Ù†Ø¨Ø¹ Ø±Ø¨Ø§Øª..."
    
    try {
        # Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø³ÛŒØ± Ù†ØµØ¨
        if (Test-Path $InstallPath) {
            Write-Warning "Ù…Ø³ÛŒØ± Ù†ØµØ¨ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ø­Ø°Ù Ù…Ø­ØªÙˆÛŒØ§Øª Ù‚Ø¨Ù„ÛŒ..."
            Remove-Item "$InstallPath\*" -Recurse -Force -ErrorAction SilentlyContinue
        }
        else {
            New-Item -ItemType Directory -Path $InstallPath -Force
        }
        
        # Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ù…Ø®Ø²Ù†
        Set-Location $InstallPath
        git clone $GitRepo .
        
        if ($LASTEXITCODE -eq 0) {
            Write-Success "Ú©Ø¯ Ù…Ù†Ø¨Ø¹ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯"
            return $true
        }
        else {
            Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ù…Ù†Ø¨Ø¹"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ù…Ù†Ø¨Ø¹: $($_.Exception.Message)"
        return $false
    }
}

function Setup-PythonEnvironment {
    Write-Step "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Python..."
    
    try {
        Set-Location $InstallPath
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ
        Write-Info "Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ Python..."
        python -m venv venv
        
        if (-not (Test-Path "venv\Scripts\activate.bat")) {
            Write-Error "Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚"
            return $false
        }
        
        # ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ Ùˆ Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
        Write-Info "Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Python..."
        
        # Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ pip
        & "venv\Scripts\python.exe" -m pip install --upgrade pip
        
        # Ù†ØµØ¨ requirements
        if (Test-Path "requirements.txt") {
            & "venv\Scripts\python.exe" -m pip install -r requirements.txt
            
            if ($LASTEXITCODE -eq 0) {
                Write-Success "Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Python Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯Ù†Ø¯"
            }
            else {
                Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Python"
                return $false
            }
        }
        else {
            Write-Warning "ÙØ§ÛŒÙ„ requirements.txt ÛŒØ§ÙØª Ù†Ø´Ø¯"
            
            # Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
            $packages = @(
                "python-telegram-bot==21.0.1",
                "python-dotenv==1.0.1",
                "openai==1.51.2",
                "google-generativeai==0.8.3",
                "requests==2.32.3",
                "aiofiles==24.1.0"
            )
            
            foreach ($package in $packages) {
                Write-Info "Ù†ØµØ¨ $package..."
                & "venv\Scripts\python.exe" -m pip install $package
            }
        }
        
        return $true
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Python: $($_.Exception.Message)"
        return $false
    }
}

function Create-ConfigFile {
    Write-Step "Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª..."
    
    try {
        Set-Location $InstallPath
        
        # Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ù†Ù…ÙˆÙ†Ù‡
        if (Test-Path ".env.example") {
            Copy-Item ".env.example" ".env"
            Write-Success "ÙØ§ÛŒÙ„ .env Ø§Ø² Ù†Ù…ÙˆÙ†Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯"
        }
        else {
            # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ .env Ù¾Ø§ÛŒÙ‡
            $envContent = @"
# Assistant Journalist Bot Configuration
# Ú©Ù¾ÛŒ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ù‡ .env Ùˆ Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯

# Bot Configuration (Required)
BOT_TOKEN=your_telegram_bot_token_here
BOT_USERNAME=your_bot_username

# AI Services (At least one required)
OPENAI_API_KEY=sk-proj-your_openai_key_here
GEMINI_API_KEY=your_gemini_key_here

# Optional APIs
NEWS_API_KEY=your_news_api_key

# Admin Users (Optional - comma separated user IDs)
ADMIN_IDS=123456789,987654321

# Database (Optional)
DATABASE_URL=sqlite:///bot.db

# Advanced Settings
MAX_REQUESTS_PER_MINUTE=30
FREE_DAILY_LIMIT=50
CACHE_TTL_HOURS=12
LOG_LEVEL=INFO
"@
            
            Set-Content -Path ".env" -Value $envContent -Encoding UTF8
            Write-Success "ÙØ§ÛŒÙ„ .env Ù¾Ø§ÛŒÙ‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
        }
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
        $directories = @("logs", "uploads", "cache", "data")
        foreach ($dir in $directories) {
            if (-not (Test-Path $dir)) {
                New-Item -ItemType Directory -Path $dir -Force | Out-Null
                Write-Info "Ù¾ÙˆØ´Ù‡ $dir Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
            }
        }
        
        return $true
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª: $($_.Exception.Message)"
        return $false
    }
}

function Test-BotInstallation {
    Write-Step "ØªØ³Øª Ù†ØµØ¨ Ø±Ø¨Ø§Øª..."
    
    try {
        Set-Location $InstallPath
        
        # ØªØ³Øª Ø³Ù„Ø§Ù…Øª
        $healthCheck = & "venv\Scripts\python.exe" main.py --version 2>&1
        
        if ($healthCheck -match "Assistant Journalist Bot") {
            Write-Success "Ø±Ø¨Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù†ØµØ¨ Ø´Ø¯: $healthCheck"
            return $true
        }
        else {
            Write-Error "ØªØ³Øª Ø±Ø¨Ø§Øª Ù†Ø§Ù…ÙˆÙÙ‚: $healthCheck"
            return $false
        }
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ù†ØµØ¨: $($_.Exception.Message)"
        return $false
    }
}

function Create-StartupScripts {
    Write-Step "Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ..."
    
    try {
        Set-Location $InstallPath
        
        # Ø§Ø³Ú©Ø±ÛŒÙ¾Øª PowerShell
        $psScript = @"
# Assistant Journalist Bot Startup Script
# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±

`$BotPath = Split-Path -Parent `$MyInvocation.MyCommand.Definition
Set-Location `$BotPath

Write-Host "ğŸ¤– Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Assistant Journalist Bot..." -ForegroundColor Cyan
Write-Host "ğŸ“ Ù…Ø³ÛŒØ±: `$BotPath" -ForegroundColor Gray

# Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
if (-not (Test-Path ".env")) {
    Write-Host "âŒ ÙØ§ÛŒÙ„ .env ÛŒØ§ÙØª Ù†Ø´Ø¯!" -ForegroundColor Red
    Write-Host "Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„ .env Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯." -ForegroundColor Yellow
    pause
    exit 1
}

# Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
try {
    & "venv\Scripts\python.exe" main.py
}
catch {
    Write-Host "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª: `$(`$_.Exception.Message)" -ForegroundColor Red
    pause
    exit 1
}
"@
        
        Set-Content -Path "start-bot.ps1" -Value $psScript -Encoding UTF8
        
        # Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Batch
        $batScript = @"
@echo off
cd /d "%~dp0"

echo ğŸ¤– Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Assistant Journalist Bot...
echo ğŸ“ Ù…Ø³ÛŒØ±: %CD%

if not exist ".env" (
    echo âŒ ÙØ§ÛŒÙ„ .env ÛŒØ§ÙØª Ù†Ø´Ø¯!
    echo Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„ .env Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.
    pause
    exit /b 1
)

venv\Scripts\python.exe main.py
if errorlevel 1 (
    echo âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
    pause
    exit /b 1
)
"@
        
        Set-Content -Path "start-bot.bat" -Value $batScript -Encoding UTF8
        
        # Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªØ³Øª Ø³Ù„Ø§Ù…Øª
        $healthScript = @"
@echo off
cd /d "%~dp0"

echo ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø±Ø¨Ø§Øª...
venv\Scripts\python.exe main.py --health

echo.
echo âœ… ØªØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯
pause
"@
        
        Set-Content -Path "health-check.bat" -Value $healthScript -Encoding UTF8
        
        Write-Success "Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯"
        return $true
    }
    catch {
        Write-Error "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§: $($_.Exception.Message)"
        return $false
    }
}

function Create-DesktopShortcut {
    Write-Step "Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒØ§Ù†Ø¨Ø± Ø¯Ø³Ú©ØªØ§Ù¾..."
    
    try {
        $WshShell = New-Object -comObject WScript.Shell
        $Shortcut = $WshShell.CreateShortcut("$env:USERPROFILE\Desktop\Assistant Journalist Bot.lnk")
        $Shortcut.TargetPath = "$InstallPath\start-bot.bat"
        $Shortcut.WorkingDirectory = $InstallPath
        $Shortcut.Description = "Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±"
        $Shortcut.IconLocation = "$InstallPath\icon.ico"
        $Shortcut.Save()
        
        Write-Success "Ù…ÛŒØ§Ù†Ø¨Ø± Ø¯Ø³Ú©ØªØ§Ù¾ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
        return $true
    }
    catch {
        Write-Warning "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒØ§Ù†Ø¨Ø± Ø¯Ø³Ú©ØªØ§Ù¾: $($_.Exception.Message)"
        return $false
    }
}

function Show-PostInstallInstructions {
    if ($Silent) { return }
    
    $instructions = @"

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                              â•‘
â•‘    ğŸ‰ Ù†ØµØ¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!                               â•‘
â•‘                                                              â•‘
â•‘    ğŸ“ Ù…Ø³ÛŒØ± Ù†ØµØ¨: $InstallPath
â•‘                                                              â•‘
â•‘    ğŸ“‹ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¹Ø¯ÛŒ:                                           â•‘
â•‘                                                              â•‘
â•‘    1ï¸âƒ£  ÙØ§ÛŒÙ„ .env Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯:                           â•‘
â•‘       â€¢ BOT_TOKEN Ø±Ø§ Ø§Ø² @BotFather Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯             â•‘
â•‘       â€¢ OPENAI_API_KEY ÛŒØ§ GEMINI_API_KEY ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯         â•‘
â•‘                                                              â•‘
â•‘    2ï¸âƒ£  Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª:                                    â•‘
â•‘       â€¢ Ø¯Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ "start-bot.bat"                      â•‘
â•‘       â€¢ ÛŒØ§ PowerShell: .\start-bot.ps1                      â•‘
â•‘                                                              â•‘
â•‘    3ï¸âƒ£  Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³Ù„Ø§Ù…Øª:                                     â•‘
â•‘       â€¢ Ø¯Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ "health-check.bat"                   â•‘
â•‘                                                              â•‘
â•‘    ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯:                                        â•‘
â•‘       â€¢ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„: README.md                            â•‘
â•‘       â€¢ ØªÙ„Ú¯Ø±Ø§Ù…: @BotFather                                  â•‘
â•‘       â€¢ OpenAI: https://platform.openai.com                 â•‘
â•‘       â€¢ Gemini: https://ai.google.dev                       â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"@
    
    Write-Host $instructions -ForegroundColor Green
}

function Show-InstallSummary {
    $endTime = Get-Date
    $duration = $endTime - $Script:StartTime
    
    if ($Silent) { return }
    
    $summary = @"

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“Š Ø®Ù„Ø§ØµÙ‡ Ù†ØµØ¨                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â±ï¸  Ø²Ù…Ø§Ù† Ù†ØµØ¨: $($duration.ToString("mm\:ss"))                                          â•‘
â•‘  âœ… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒÙ‡Ø§: $($Script:ErrorCount -eq 0 ? 'Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„' : 'Ø¨Ø§ Ø®Ø·Ø§')                              â•‘
â•‘  âŒ Ø®Ø·Ø§Ù‡Ø§: $Script:ErrorCount                                              â•‘
â•‘  âš ï¸  Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§: $Script:WarningCount                                           â•‘
â•‘                                                              â•‘
â•‘  ğŸ“ Ù…Ø³ÛŒØ± Ù†ØµØ¨: $InstallPath
â•‘  ğŸ“„ ÙØ§ÛŒÙ„ Ù„Ø§Ú¯: $Script:LogFile                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"@
    
    if ($Script:ErrorCount -eq 0) {
        Write-Host $summary -ForegroundColor Green
    } else {
        Write-Host $summary -ForegroundColor Yellow
    }
}

# ====================================================================
# ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù†ØµØ¨
# ====================================================================

function Start-Installation {
    # Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§
    if ($Help) {
        Show-Help
    }
    
    # Ù†Ù…Ø§ÛŒØ´ Ø¨Ù†Ø±
    Show-Banner
    
    # Ø´Ø±ÙˆØ¹ Ù„Ø§Ú¯
    "=== Assistant Journalist Bot Installation Log ===" | Out-File -FilePath $Script:LogFile -Encoding UTF8
    "Start Time: $(Get-Date)" | Out-File -FilePath $Script:LogFile -Append -Encoding UTF8
    "Install Path: $InstallPath" | Out-File -FilePath $Script:LogFile -Append -Encoding UTF8
    
    Write-Info "Ø´Ø±ÙˆØ¹ Ù†ØµØ¨ Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±..."
    Write-Info "Ù…Ø³ÛŒØ± Ù†ØµØ¨: $InstallPath"
    Write-Info "ÙØ§ÛŒÙ„ Ù„Ø§Ú¯: $Script:LogFile"
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
    if (-not (Test-AdminRights)) {
        Write-Error "Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø±Ø¯"
        Write-Info "Ù„Ø·ÙØ§Ù‹ PowerShell Ø±Ø§ Ø¨Ø§ 'Run as Administrator' Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯"
        exit 1
    }
    
    if (-not (Test-InternetConnection)) {
        Write-Error "Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª"
        Write-Info "Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯"
        exit 1
    }
    
    Write-Success "Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯"
    
    # Ù…Ø±Ø§Ø­Ù„ Ù†ØµØ¨
    $installSteps = @(
        @{ Name = "Chocolatey"; Function = { Install-Chocolatey } },
        @{ Name = "Python"; Function = { Install-Python } },
        @{ Name = "Git"; Function = { Install-Git } },
        @{ Name = "FFmpeg"; Function = { Install-FFmpeg } },
        @{ Name = "Bot Source"; Function = { Download-BotSource } },
        @{ Name = "Python Environment"; Function = { Setup-PythonEnvironment } },
        @{ Name = "Config File"; Function = { Create-ConfigFile } },
        @{ Name = "Startup Scripts"; Function = { Create-StartupScripts } },
        @{ Name = "Desktop Shortcut"; Function = { Create-DesktopShortcut } },
        @{ Name = "Installation Test"; Function = { Test-BotInstallation } }
    )
    
    $completedSteps = 0
    foreach ($step in $installSteps) {
        Write-Info "Ù…Ø±Ø­Ù„Ù‡ $($completedSteps + 1)/$($installSteps.Count): $($step.Name)"
        
        $result = & $step.Function
        
        if ($result) {
            $completedSteps++
            Write-Success "Ù…Ø±Ø­Ù„Ù‡ $($step.Name) Ú©Ø§Ù…Ù„ Ø´Ø¯ âœ“"
        } else {
            Write-Error "Ù…Ø±Ø­Ù„Ù‡ $($step.Name) Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ âœ—"
            
            if (-not $Silent) {
                $continue = Read-Host "Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯ØŸ (y/N)"
                if ($continue -ne 'y' -and $continue -ne 'Y') {
                    Write-Info "Ù†ØµØ¨ Ù„ØºÙˆ Ø´Ø¯"
                    exit 1
                }
            }
        }
        
        Write-Host ""
    }
    
    # Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
    Show-InstallSummary
    
    # Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ù¾Ø³ Ø§Ø² Ù†ØµØ¨
    if ($Script:ErrorCount -eq 0) {
        Show-PostInstallInstructions
    } else {
        Write-Warning "Ù†ØµØ¨ Ø¨Ø§ $Script:ErrorCount Ø®Ø·Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯"
        Write-Info "Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù„Ø§Ú¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯: $Script:LogFile"
    }
    
    # ØªÙ…ÛŒØ² Ú©Ø±Ø¯Ù†
    if (-not $Silent) {
        Write-Host "Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ú©Ù„ÛŒØ¯ÛŒ Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯..." -ForegroundColor Gray
        $null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
    }
}

# ====================================================================
# Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ Ø§Ø¶Ø§ÙÛŒ
# ====================================================================

function New-UninstallScript {
    $uninstallScript = @"
# Assistant Journalist Bot - Uninstaller
# Ø­Ø°Ù Ú©Ø§Ù…Ù„ Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±

param(
    [switch]`$Force,
    [switch]`$KeepConfig
)

`$BotPath = "$InstallPath"

Write-Host "ğŸ—‘ï¸  Ø­Ø°Ù Assistant Journalist Bot..." -ForegroundColor Red

if (-not `$Force) {
    `$confirm = Read-Host "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ (y/N)"
    if (`$confirm -ne 'y' -and `$confirm -ne 'Y') {
        Write-Host "Ù„ØºÙˆ Ø´Ø¯" -ForegroundColor Yellow
        exit 0
    }
}

# Ø­Ø°Ù ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
if (Test-Path `$BotPath) {
    if (`$KeepConfig -and (Test-Path "`$BotPath\.env")) {
        `$backupConfig = "`$env:USERPROFILE\Desktop\assistant-bot-config-backup.env"
        Copy-Item "`$BotPath\.env" `$backupConfig
        Write-Host "âœ… ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø¯" -ForegroundColor Green
    }
    
    Remove-Item `$BotPath -Recurse -Force
    Write-Host "âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª Ø­Ø°Ù Ø´Ø¯Ù†Ø¯" -ForegroundColor Green
}

# Ø­Ø°Ù Ù…ÛŒØ§Ù†Ø¨Ø±
`$shortcut = "`$env:USERPROFILE\Desktop\Assistant Journalist Bot.lnk"
if (Test-Path `$shortcut) {
    Remove-Item `$shortcut -Force
    Write-Host "âœ… Ù…ÛŒØ§Ù†Ø¨Ø± Ø¯Ø³Ú©ØªØ§Ù¾ Ø­Ø°Ù Ø´Ø¯" -ForegroundColor Green
}

Write-Host "ğŸ‰ Ø­Ø°Ù Ú©Ø§Ù…Ù„ Ø´Ø¯!" -ForegroundColor Green
pause
"@
    
    Set-Content -Path "$InstallPath\uninstall.ps1" -Value $uninstallScript -Encoding UTF8
}

function New-UpdateScript {
    $updateScript = @"
# Assistant Journalist Bot - Updater
# Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±

`$BotPath = Split-Path -Parent `$MyInvocation.MyCommand.Definition
Set-Location `$BotPath

Write-Host "ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Assistant Journalist Bot..." -ForegroundColor Cyan

# Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª
if (Test-Path ".env") {
    Copy-Item ".env" ".env.backup"
    Write-Host "âœ… ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø¯" -ForegroundColor Green
}

# Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª
try {
    git pull origin main
    Write-Host "âœ… Ú©Ø¯ Ù…Ù†Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯" -ForegroundColor Green
} catch {
    Write-Host "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: `$(`$_.Exception.Message)" -ForegroundColor Red
    exit 1
}

# Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
Write-Host "ğŸ“¦ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Python..." -ForegroundColor Yellow
& "venv\Scripts\python.exe" -m pip install --upgrade pip
& "venv\Scripts\python.exe" -m pip install -r requirements.txt --upgrade

# Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
if (Test-Path ".env.backup") {
    Move-Item ".env.backup" ".env"
    Write-Host "âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯" -ForegroundColor Green
}

# ØªØ³Øª
Write-Host "ğŸ§ª ØªØ³Øª Ø±Ø¨Ø§Øª..." -ForegroundColor Yellow
`$test = & "venv\Scripts\python.exe" main.py --version 2>&1
if (`$test -match "Assistant Journalist Bot") {
    Write-Host "âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯: `$test" -ForegroundColor Green
} else {
    Write-Host "âŒ Ù…Ø´Ú©Ù„ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: `$test" -ForegroundColor Red
}

pause
"@
    
    Set-Content -Path "$InstallPath\update.ps1" -Value $updateScript -Encoding UTF8
}

function New-ConfigHelper {
    $configHelper = @"
# Assistant Journalist Bot - Config Helper
# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… ÙØ§ÛŒÙ„ .env

Write-Host "âš™ï¸  Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Assistant Journalist Bot" -ForegroundColor Cyan
Write-Host "=" * 50

# Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ .env
if (-not (Test-Path ".env")) {
    Write-Host "âŒ ÙØ§ÛŒÙ„ .env ÛŒØ§ÙØª Ù†Ø´Ø¯!" -ForegroundColor Red
    exit 1
}

# Ø®ÙˆØ§Ù†Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ù„ÛŒ
`$envContent = Get-Content ".env"
`$config = @{}

foreach (`$line in `$envContent) {
    if (`$line -match "^([A-Z_]+)=(.*)") {
        `$config[`$matches[1]] = `$matches[2]
    }
}

Write-Host ""
Write-Host "ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ù„ÛŒ:" -ForegroundColor Yellow
Write-Host ""

# Ø¨Ø±Ø±Ø³ÛŒ BOT_TOKEN
if (`$config.BOT_TOKEN -and `$config.BOT_TOKEN -ne "your_telegram_bot_token_here") {
    Write-Host "âœ… BOT_TOKEN: ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡" -ForegroundColor Green
} else {
    Write-Host "âŒ BOT_TOKEN: ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡" -ForegroundColor Red
    Write-Host "   ğŸ‘‰ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¨Ù‡ @BotFather Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯" -ForegroundColor Gray
}

# Ø¨Ø±Ø±Ø³ÛŒ API Keys
`$hasAI = `$false
if (`$config.OPENAI_API_KEY -and `$config.OPENAI_API_KEY -ne "sk-proj-your_openai_key_here") {
    Write-Host "âœ… OPENAI_API_KEY: ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡" -ForegroundColor Green
    `$hasAI = `$true
} else {
    Write-Host "âš ï¸  OPENAI_API_KEY: ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡" -ForegroundColor Yellow
}

if (`$config.GEMINI_API_KEY -and `$config.GEMINI_API_KEY -ne "your_gemini_key_here") {
    Write-Host "âœ… GEMINI_API_KEY: ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡" -ForegroundColor Green
    `$hasAI = `$true
} else {
    Write-Host "âš ï¸  GEMINI_API_KEY: ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡" -ForegroundColor Yellow
}

if (-not `$hasAI) {
    Write-Host "âŒ Ù‡ÛŒÚ† AI API ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡! Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª" -ForegroundColor Red
}

Write-Host ""
Write-Host "ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯:" -ForegroundColor Cyan
Write-Host "   â€¢ Telegram Bot: https://t.me/BotFather" -ForegroundColor Gray
Write-Host "   â€¢ OpenAI API: https://platform.openai.com/api-keys" -ForegroundColor Gray
Write-Host "   â€¢ Gemini API: https://ai.google.dev" -ForegroundColor Gray

Write-Host ""
if (`$config.BOT_TOKEN -ne "your_telegram_bot_token_here" -and `$hasAI) {
    Write-Host "ğŸ‰ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ù…Ù„ Ø§Ø³Øª! Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø±Ø¨Ø§Øª Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯" -ForegroundColor Green
} else {
    Write-Host "âš ï¸  Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯" -ForegroundColor Yellow
}

pause
"@
    
    Set-Content -Path "$InstallPath\config-helper.ps1" -Value $configHelper -Encoding UTF8
}

# ====================================================================
# Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
# ====================================================================

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¬Ø±Ø§ Ø§Ø² PowerShell
if ($MyInvocation.MyCommand.CommandType -eq "ExternalScript") {
    # Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡ Ø§Ø² ÙØ§ÛŒÙ„
    try {
        Start-Installation
        
        # Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ
        if ($Script:ErrorCount -eq 0) {
            New-UninstallScript
            New-UpdateScript  
            New-ConfigHelper
            Write-Info "Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯"
        }
        
    } catch {
        Write-Error "Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ Ø¯Ø± Ù†ØµØ¨: $($_.Exception.Message)"
        Write-Info "ÙØ§ÛŒÙ„ Ù„Ø§Ú¯: $Script:LogFile"
        exit 1
    }
} else {
    # Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹
    Write-Host "ğŸš€ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾ØªØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙØ§ÛŒÙ„ .ps1 Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯" -ForegroundColor Yellow
    Write-Host "Ù…Ø«Ø§Ù„: .\install.ps1" -ForegroundColor Gray
}

# ====================================================================
# Ù¾Ø§ÛŒØ§Ù† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
# ====================================================================

<#
.SYNOPSIS
    Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø±Ø¨Ø§Øª Ø¯Ø³ØªÛŒØ§Ø± Ø®Ø¨Ø±Ù†Ú¯Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ²

.DESCRIPTION
    Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ…Ø§Ù… Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ Ùˆ Ø®ÙˆØ¯ Ø±Ø¨Ø§Øª Ø±Ø§ Ù†ØµØ¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:
    - Python 3.11
    - Git  
    - FFmpeg
    - Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Python
    - Ú©Ø¯ Ù…Ù†Ø¨Ø¹ Ø±Ø¨Ø§Øª
    - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡

.PARAMETER InstallPath
    Ù…Ø³ÛŒØ± Ù†ØµØ¨ Ø±Ø¨Ø§Øª (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: %USERPROFILE%\AssistantJournalistBot)

.PARAMETER GitRepo
    Ø¢Ø¯Ø±Ø³ Ù…Ø®Ø²Ù† Git

.PARAMETER SkipChocolatey
    Ø¹Ø¯Ù… Ù†ØµØ¨ Chocolatey

.PARAMETER SkipPython
    Ø¹Ø¯Ù… Ù†ØµØ¨ Python

.PARAMETER SkipGit
    Ø¹Ø¯Ù… Ù†ØµØ¨ Git

.PARAMETER SkipFFmpeg
    Ø¹Ø¯Ù… Ù†ØµØ¨ FFmpeg

.PARAMETER Silent
    Ø­Ø§Ù„Øª Ø³Ø§Ú©Øª (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø§Ù…Ù„)

.PARAMETER Help
    Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§

.EXAMPLE
    .\install.ps1
    Ù†ØµØ¨ Ù…Ø¹Ù…ÙˆÙ„ÛŒ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶

.EXAMPLE
    .\install.ps1 -InstallPath "C:\Bots\JournalistBot" -Silent
    Ù†ØµØ¨ Ø¯Ø± Ù…Ø³ÛŒØ± Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø³Ø§Ú©Øª

.EXAMPLE
    .\install.ps1 -SkipChocolatey -SkipPython
    Ù†ØµØ¨ Ø¨Ø¯ÙˆÙ† Chocolatey Ùˆ Python (Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù†ØµØ¨ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯)

.NOTES
    Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Assistant Journalist Bot Team
    Ù†Ø³Ø®Ù‡: 1.0.0
    Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø±Ø¯
    Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ² 10+ Ùˆ PowerShell 5.1+

.LINK
    https://github.com/your-username/assistant-journalist-bot
#>
